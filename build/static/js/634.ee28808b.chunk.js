"use strict";(self.webpackChunkquero_paz=self.webpackChunkquero_paz||[]).push([[634],{3634:(e,n,s)=>{s.r(n),s.d(n,{default:()=>D});var t=s(9379),i=s(5043),r=s(3969),a=s(5895),o=s(4009),c=s(1244),l=s(6128),d=s(8065),y=s(5315),A=s(2455),h=s(6185),m=s(2097),x=s(172),g=s(6803),S=s(1725),v=s(6384),j=s(2579),u=s(916),p=s(1148),f=s(863),E=s(6454),z=s(6936),w=s(1553),C=s(3106),L=s(1981),b=s(7505),I=s(579);const D=()=>{const[e,n]=(0,i.useState)({isOnline:navigator.onLine,lastSync:null,pendingChanges:0,isSyncing:!1,syncError:null,autoSync:!0}),[s,D]=(0,i.useState)({totalSyncs:0,failedSyncs:0,totalDataSynced:0,compressionRatio:0}),[O,k]=(0,i.useState)({open:!1,message:"",severity:"info"});(0,i.useEffect)((()=>{const e=()=>{n((e=>(0,t.A)((0,t.A)({},e),{},{isOnline:navigator.onLine}))),navigator.onLine&&n((e=>(e.pendingChanges>0&&e.autoSync&&setTimeout((()=>M()),0),e)))};return(async()=>{try{const e=await b.A.getItem("settings","syncSettings")||{},s=await b.A.getItem("statistics","syncStats")||{totalSyncs:0,failedSyncs:0,totalDataSynced:0,compressionRatio:0},i=await b.A.getItem("sync","lastSyncTime"),r=await L.A.getPendingChangesCount();n((n=>(0,t.A)((0,t.A)({},n),{},{lastSync:i,pendingChanges:r,autoSync:void 0===e.autoSync||e.autoSync}))),D(s)}catch(e){console.error("Error loading sync data:",e),k({open:!0,message:"Erro ao carregar dados de sincroniza\xe7\xe3o",severity:"error"})}})(),window.addEventListener("online",e),window.addEventListener("offline",e),L.A.addEventListener("syncStart",R),L.A.addEventListener("syncComplete",q),L.A.addEventListener("syncError",T),L.A.addEventListener("dataChanged",B),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e),L.A.removeEventListener("syncStart",R),L.A.removeEventListener("syncComplete",q),L.A.removeEventListener("syncError",T),L.A.removeEventListener("dataChanged",B)}}),[]);const R=()=>{n((e=>(0,t.A)((0,t.A)({},e),{},{isSyncing:!0,syncError:null})))},q=e=>{const{syncedData:s,compressionRatio:i}=e.detail||{},r=s?Math.round(s/1024):0;n((e=>(0,t.A)((0,t.A)({},e),{},{isSyncing:!1,lastSync:new Date,pendingChanges:0}))),D((e=>{const n={totalSyncs:e.totalSyncs+1,failedSyncs:e.failedSyncs,totalDataSynced:e.totalDataSynced+r,compressionRatio:i||e.compressionRatio};return b.A.setItem("statistics","syncStats",n),n})),k({open:!0,message:"Sincroniza\xe7\xe3o conclu\xedda com sucesso",severity:"success"})},T=e=>{let s="Erro desconhecido durante a sincroniza\xe7\xe3o";if(e&&e.detail&&e.detail.error)if("string"===typeof e.detail.error)s=e.detail.error;else if(e.detail.error.message)s=e.detail.error.message;else try{s=e.detail.error.toString()}catch(i){}console.log("Sync error handler received:",s),n((e=>(0,t.A)((0,t.A)({},e),{},{isSyncing:!1,syncError:s}))),D((e=>{const n=(0,t.A)((0,t.A)({},e),{},{failedSyncs:(e.failedSyncs||0)+1});try{b.A.setItem("statistics","syncStats",n).catch((e=>console.error("Erro ao salvar estat\xedsticas:",e)))}catch(i){console.error("Erro ao salvar estat\xedsticas de sincroniza\xe7\xe3o:",i)}return n})),k({open:!0,message:"Erro na sincroniza\xe7\xe3o: ".concat(s),severity:"error"})},B=()=>{n((e=>(0,t.A)((0,t.A)({},e),{},{pendingChanges:e.pendingChanges+1})))},M=async()=>{if(navigator.onLine)if(e.isSyncing)k({open:!0,message:"Sincroniza\xe7\xe3o j\xe1 em andamento",severity:"info"});else{n((e=>(0,t.A)((0,t.A)({},e),{},{isSyncing:!0,syncError:null})));try{const e=await L.A.syncAll();console.log("Sync result:",e)}catch(s){console.error("Manual sync error:",s);const e=(null===s||void 0===s?void 0:s.message)||(null===s||void 0===s?void 0:s.toString())||"Erro desconhecido";k({open:!0,message:"Erro na sincroniza\xe7\xe3o: ".concat(e),severity:"error"});const i=new CustomEvent("syncError",{detail:{error:e}});window.dispatchEvent(i),n((n=>(0,t.A)((0,t.A)({},n),{},{isSyncing:!1,syncError:e})))}}else k({open:!0,message:"Voc\xea est\xe1 offline. A sincroniza\xe7\xe3o ocorrer\xe1 quando voc\xea estiver online novamente.",severity:"warning"})},_=()=>{k((e=>(0,t.A)((0,t.A)({},e),{},{open:!1})))};return(0,I.jsxs)(r.A,{sx:{p:3},children:[(0,I.jsx)(a.A,{variant:"h4",component:"h2",gutterBottom:!0,children:"Gerenciamento de Sincroniza\xe7\xe3o"}),(0,I.jsxs)(o.A,{container:!0,spacing:3,children:[(0,I.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,I.jsx)(c.A,{children:(0,I.jsxs)(l.A,{children:[(0,I.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,I.jsx)(a.A,{variant:"h6",component:"h3",children:"Status"}),e.isOnline?(0,I.jsx)(d.A,{title:"Online",children:(0,I.jsx)(p.A,{color:"primary",sx:{ml:1}})}):(0,I.jsx)(d.A,{title:"Offline",children:(0,I.jsx)(f.A,{color:"error",sx:{ml:1}})})]}),(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{children:(0,I.jsx)(h.A,{primary:"Status da conex\xe3o",secondary:e.isOnline?"Online":"Offline"})}),(0,I.jsx)(A.Ay,{children:(0,I.jsx)(h.A,{primary:"\xdaltima sincroniza\xe7\xe3o",secondary:(F=e.lastSync,F?("string"===typeof F&&(F=new Date(F)),F.toLocaleString()):"Nunca")})}),(0,I.jsx)(A.Ay,{children:(0,I.jsx)(h.A,{primary:"Altera\xe7\xf5es pendentes",secondary:e.pendingChanges})})]}),(0,I.jsx)(m.A,{variant:"contained",color:"primary",startIcon:e.isSyncing?(0,I.jsx)(x.A,{size:20,color:"inherit"}):(0,I.jsx)(E.A,{}),disabled:!e.isOnline||e.isSyncing,onClick:M,fullWidth:!0,sx:{mt:2},children:e.isSyncing?"Sincronizando...":"Sincronizar Agora"}),e.syncError&&(0,I.jsx)(g.A,{severity:"error",sx:{mt:2},children:"Erro na \xfaltima sincroniza\xe7\xe3o: ".concat(e.syncError)})]})})}),(0,I.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,I.jsx)(c.A,{children:(0,I.jsxs)(l.A,{children:[(0,I.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,I.jsx)(a.A,{variant:"h6",component:"h3",children:"Configura\xe7\xf5es"}),(0,I.jsx)(z.A,{sx:{ml:1}})]}),(0,I.jsx)(y.A,{children:(0,I.jsxs)(A.Ay,{children:[(0,I.jsx)(S.A,{control:(0,I.jsx)(v.A,{checked:e.autoSync,onChange:async e=>{const s=e.target.checked;n((e=>(0,t.A)((0,t.A)({},e),{},{autoSync:s})));const i=await b.A.getItem("settings","syncSettings")||{};i.autoSync=s,await b.A.setItem("settings","syncSettings",i),k({open:!0,message:"Sincroniza\xe7\xe3o autom\xe1tica ".concat(s?"ativada":"desativada"),severity:"info"})},color:"primary"}),label:"Sincroniza\xe7\xe3o autom\xe1tica"}),(0,I.jsx)(d.A,{title:"Sincroniza automaticamente quando voc\xea estiver online",children:(0,I.jsx)(j.A,{size:"small",children:(0,I.jsx)(w.A,{fontSize:"small"})})})]})})]})})}),(0,I.jsx)(o.A,{item:!0,xs:12,children:(0,I.jsx)(c.A,{children:(0,I.jsxs)(l.A,{children:[(0,I.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,I.jsx)(a.A,{variant:"h6",component:"h3",children:"Estat\xedsticas de Sincroniza\xe7\xe3o"}),(0,I.jsx)(C.A,{sx:{ml:1}})]}),(0,I.jsxs)(o.A,{container:!0,spacing:2,children:[(0,I.jsxs)(o.A,{item:!0,xs:6,sm:3,children:[(0,I.jsx)(a.A,{variant:"subtitle2",color:"textSecondary",children:"Total de sincroniza\xe7\xf5es"}),(0,I.jsx)(a.A,{variant:"h5",children:s.totalSyncs})]}),(0,I.jsxs)(o.A,{item:!0,xs:6,sm:3,children:[(0,I.jsx)(a.A,{variant:"subtitle2",color:"textSecondary",children:"Sincroniza\xe7\xf5es falhas"}),(0,I.jsx)(a.A,{variant:"h5",children:s.failedSyncs})]}),(0,I.jsxs)(o.A,{item:!0,xs:6,sm:3,children:[(0,I.jsx)(a.A,{variant:"subtitle2",color:"textSecondary",children:"Dados sincronizados"}),(0,I.jsxs)(a.A,{variant:"h5",children:[s.totalDataSynced," KB"]})]}),(0,I.jsxs)(o.A,{item:!0,xs:6,sm:3,children:[(0,I.jsx)(a.A,{variant:"subtitle2",color:"textSecondary",children:"Taxa de compress\xe3o"}),(0,I.jsxs)(a.A,{variant:"h5",children:[s.compressionRatio.toFixed(2),"x"]})]})]})]})})})]}),(0,I.jsx)(u.A,{open:O.open,autoHideDuration:6e3,onClose:_,children:(0,I.jsx)(g.A,{onClose:_,severity:O.severity,children:O.message})})]});var F}}}]);
//# sourceMappingURL=634.ee28808b.chunk.js.map